<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NYPADROX Offline Chat</title>
<style>
:root{--bg:#0b1020;--panel:#0f1724;--accent:#6c5ce7;--muted:#9aa4b2}
body{margin:0;background:var(--bg);color:#fff;font-family:Inter,Arial,Helvetica,sans-serif;display:flex;align-items:center;justify-content:center;height:100vh}
.chat{width:100%;max-width:760px;height:90vh;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,0.6);display:flex;flex-direction:column;overflow:hidden;border:1px solid rgba(255,255,255,0.03);position:relative;}
.header{padding:18px 20px;display:flex;align-items:center;gap:12px;border-bottom:1px solid rgba(255,255,255,0.03)}
.logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#00bcd4);display:flex;align-items:center;justify-content:center;font-weight:700}
.title{font-size:18px}
.body{flex:1;padding:20px;overflow:auto;display:flex;flex-direction:column;gap:12px}
.bubbles{display:flex;flex-direction:column;gap:12px;max-width:100%}
.bubble{padding:12px 16px;border-radius:12px;max-width:75%;line-height:1.3;position:relative}
.user{align-self:flex-end;background: linear-gradient(90deg, #3b3f50, #1f2230);color:white;border-bottom-right-radius:4px;}
.bot{align-self:flex-start;background: rgba(75,63,127,0.15);color: #fff;border-bottom-left-radius:4px;transition: transform 0.1s ease;animation: bubblePop 0.3s ease forwards;box-shadow: none;}
.bot-special {align-self:flex-start;background: rgba(75,63,127,0.1);color: #fff;border-bottom-left-radius:4px;box-shadow: none;animation: bubblePop 0.3s ease forwards;}
@keyframes bubblePop {0% { transform: scale(0.6); opacity: 0; }50% { transform: scale(1.05); opacity: 1; }100% { transform: scale(1); }}
.footer{padding:12px 16px;border-top:1px solid rgba(255,255,255,0.03);display:flex;gap:8px;align-items:center}
input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff}
button.send{background:var(--accent);border:none;color:white;padding:10px 14px;border-radius:10px;cursor:pointer}
button.reset{background:#ff3f3f;border:none;color:white;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
button.reset:hover{background:#ff5757}
.timestamp{font-size:12px;color:var(--muted);position:absolute;bottom:-16px;right:8px}
.phone a{color:#78a1d3;text-decoration:underline;cursor:pointer}
.whatsapp-btn {position: absolute;right: 20px;bottom: 80px;background-color: #25D366;color: white;border-radius: 50%;width: 55px;height: 55px;display: flex;justify-content: center;align-items: center;font-size: 28px;box-shadow: 0 4px 10px rgba(0,0,0,0.4);cursor: pointer;transition: transform 0.2s ease, box-shadow 0.2s ease;z-index: 1000;animation: pulse 2s infinite;}
.whatsapp-btn:hover { transform: scale(1.15); box-shadow: 0 6px 14px rgba(0,0,0,0.6); animation: none; }
@keyframes pulse {0% { transform: scale(1); box-shadow: 0 4px 10px rgba(0,0,0,0.4); }50% { transform: scale(1.1); box-shadow: 0 6px 14px rgba(0,0,0,0.6); }100% { transform: scale(1); box-shadow: 0 4px 10px rgba(0,0,0,0.4); }}
@media (max-width: 600px) {.whatsapp-btn { bottom: 120px; right: 15px;width: 50px;height: 50px;font-size: 24px;}}
.cursor{display:inline-block;width:1px;background:#fff;animation:blink 1s step-start infinite;}
@keyframes blink{50%{opacity:0}}
</style>
</head>
<body>

<div class="chat">
  <div class="header">
    <div class="logo">NP</div>
    <div>
      <div class="title">NYPADROX Support</div>
      <div class="muted">Online Mode</div>
    </div>
  </div>

  <div class="body" id="body">
    <div class="bubbles" id="bubbles">
      <div class="bubble bot">
        (NP: Welcome to NYPADROX ‚Äî how can we help you today?<br>
        For orders email <span class="phone"><a href="mailto:Rowlandmchinyira5@gmail.com">Rowlandmchinyira5@gmail.com</a></span> or call 
        <span class="phone"><a href="tel:+265899174287">+265 899 174 287</a></span> / 
        <span class="phone"><a href="tel:+265990672107">+265 990 672 107 Mr ROWLAND MCHINYIRA</a></span>)
        <div class="timestamp"></div>
      </div>
    </div>
  </div>

  <div class="footer">
    <input id="msg" placeholder="Type your message..." autocomplete="off">
    <button class="send" id="sendBtn">Send</button>
    <button class="reset" id="resetBtn">Reset Chat</button>
  </div>

  <a href="https://wa.me/265899174287" target="_blank" class="whatsapp-btn" title="Chat on WhatsApp">
    <svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24" width="30px" height="30px">
      <path d="M20.52 3.48A11.77 11.77 0 0 0 12 0C5.37 0 .02 5.37.02 12c0 2.11.55 4.19 1.59 6.03L0 24l6.19-1.61A11.84 11.84 0 0 0 12 24c6.63 0 12-5.37 12-12 0-3.19-1.24-6.19-3.48-8.52zm-8.52 18c-1.79 0-3.55-.46-5.09-1.33l-.36-.21-3.67.95.98-3.58-.23-.37A9.96 9.96 0 0 1 2 12c0-5.52 4.48-10 10-10 2.67 0 5.17 1.04 7.07 2.93A9.93 9.93 0 0 1 22 12c0 5.52-4.48 10-10 10zm5.41-7.54c-.3-.15-1.79-.88-2.07-.98-.28-.1-.49-.15-.7.15-.21.3-.8.98-.98 1.18-.18.2-.36.23-.67.08-.3-.15-1.27-.47-2.42-1.5-.9-.8-1.5-1.79-1.67-2.09-.17-.3-.02-.46.13-.61.13-.13.3-.36.46-.54.15-.18.2-.3.3-.5.1-.2.05-.38-.02-.54-.08-.15-.7-1.7-.96-2.33-.25-.6-.5-.52-.7-.53h-.6c-.2 0-.54.08-.83.38-.3.3-1.1 1.08-1.1 2.63 0 1.55 1.13 3.05 1.29 3.25.15.2 2.23 3.4 5.4 4.76.76.33 1.35.53 1.82.68.76.24 1.45.21 2 .13.61-.09 1.79-.73 2.04-1.44.25-.71.25-1.32.17-1.44-.08-.12-.27-.2-.57-.35z"/>
    </svg>
  </a>
</div>

<audio id="typingSound" src="https://www.soundjay.com/button/beep -07.wav" preload="auto"></audio>

<script>
// ---------------- Products & Responses ----------------
const productsCatalog = {
  "Electronics": ['solar', 'arduino', 'drone','computer','computers', 'rc'],
  "Crops": ['maize', 'beans', 'ground', 'cabbage', 'sugarcane', 'vegetables'],
  "Animals": ['chicken', 'pig', 'piglets','eggs'],
  "Computers": {
    "Types": ['laptop','desktop', 'pc', 'notebook', 'server'],
    "Brands": ['hp','dell','lenovo','acer','asus','msi','apple','macbook','imac','toshiba','samsung'],
    "Speces": ['16GB RAM','32GB RAM','64GB RAM','Intel i5','Intel i7','Intel i9','AMD Ryzen 5','AMD Ryzen 7','AMD Ryzen 9','1TB','2TB','4TB','8TB','16TB',"from the list what do you like to buy or order?"]
  }
};
const productMap = {"maiz":"maize","bean":"beans","chikn":"chicken","comper":"computer","laptap":"laptop","drons":"drone","chik":"chicken"};
const productsKeywords = [];
for(const cat in productsCatalog){
  const items = productsCatalog[cat];
  if(Array.isArray(items)) items.forEach(i => productsKeywords.push(i.toLowerCase()));
  else for(const sub in items) items[sub].forEach(i => productsKeywords.push(i.toLowerCase()));
}
Object.keys(productMap).forEach(k => productsKeywords.push(k.toLowerCase()));

const chatContext = { mentionedProducts: new Set() };
const typingPhrases = ["Nypadrox is processing", "Thinking...", "Generating response"];
const botEmojis = ["üôÇ","ü§ñ","üëç","üí°"];
const genericResponses = [
  "I'm here to help! Ask about products, orders, or support.",
  "Sure! You can ask about any of our products or services.",
  "That's interesting! Did you want to place an order or see our catalog?",
  "I can help with orders, product info, or guidance. What would you like?"
];

const responses = [
  {text:"Hello there! What would you like to buy or order from Nypadrox today?", keywords:['hi','hello','hey','hy'], required:[]},
  {text:"I'm doing fine, thanks for asking! How about you?", keywords:['how','are','you'], required:['how']},
  {text:"I usually eat data and algorithms", keywords:['what','you','eat'], required:['you','eat']},
  {text:"Why did the computer go to the doctor? Because it caught a virus!", keywords:['tell','joke'], required:['joke']},
  {text:"You're welcome!", keywords:['thank','thanks'], required:[]},
  {text:"Anytime! I'm happy to help.", keywords:['you','welcome'], required:['welcome']},
  {text:"Goodbye! Talk to you later", keywords:['bye','goodbye','see','you'], required:[]},
  {text:"We sell: solar, arduino, drone, computers, maize, beans, chicken. Call <a href='tel:+...Call <a href='tel:+265899174287'>+265 899 174 287</a> or <a href='tel:+265990672107'>+265 990 672 107 Mr ROWLAND MCHINYIRA</a> or email <a href='mailto:Rowlandmchinyira5@gmail.com'>Rowlandmchinyira5@gmail.com</a>", keywords:['buy','order','want','need','purchase','product','item','sell','do you have'], required:[]},
  {text:"I am NP, Nypadrox AI assistant in sales", keywords:["what","name","who"], required:[]},
  {text: function() { 
      let output = "";
      for (const cat in productsCatalog) {
        output += `<strong>${cat}:</strong> `;
        const items = productsCatalog[cat];
        if (Array.isArray(items)) {
          output += items.join(", ");
        } else {
          for (const sub in items) {
            output += `<br><em>${sub}:</em> ` + items[sub].join(", ");
          }
        }
        output += "<br>";
      }
      return output;
    }, 
    keywords: ["list","all","products","sell","order","catalog","show","yes","of course","sales"], required: []
  }
];

// ---------------- Helpers ----------------
function detectProducts(msg){
  const found = [];
  productsKeywords.forEach(p=>{
    if(msg.toLowerCase().includes(p)){
      found.push(productMap[p] || p);
    }
  });
  return [...new Set(found)];
}

function appendEmoji(text) {
  const emoji = botEmojis[Math.floor(Math.random() * botEmojis.length)];
  return text + " " + emoji;
}

// ---------------- Bot Response ----------------
function getResponse(message){
  const matchedProducts = detectProducts(message);
  
  if(matchedProducts.length){
    const newProducts = matchedProducts.filter(p => !chatContext.mentionedProducts.has(p));
    matchedProducts.forEach(p => chatContext.mentionedProducts.add(p));
    if(newProducts.length){
      return appendEmoji(`NP: You mentioned ${newProducts.join(", ")}. For orders call <a href="tel:+265899174287">+265 899 174 287</a> or <a href="tel:+265990672107">+265 990 672 107 Mr ROWLAND MCHINYIRA</a> or email <a href="mailto:Rowlandmchinyira5@gmail.com">Rowlandmchinyira5@gmail.com</a>`);
    } else {
      return appendEmoji(`NP: You already mentioned ${matchedProducts.join(", ")}. Call <a href="tel:+265899174287">+265 899 174 287</a> or <a href="tel:+265990672107">+265 990 672 107 Mr ROWLAND MCHINYIRA</a> or email <a href="mailto:Rowlandmchinyira5@gmail.com">Rowlandmchinyira5@gmail.com</a>`);
    }
  }

  const words = message.toLowerCase().split(/\s+/);
  let bestScore=0, bestResp="";

  responses.forEach(r=>{
    let score=0;
    r.keywords.forEach(k=>{ if(words.includes(k)) score++; });
    r.required.forEach(req=>{ if(!words.includes(req)) score=0; });
    if(score>bestScore){ 
      bestScore = score; 
      bestResp = (typeof r.text==="function") ? r.text() : r.text; 
    }
  });

  if(bestScore === 0){
    const randomIndex = Math.floor(Math.random() * genericResponses.length);
    return appendEmoji(`NP: ${genericResponses[randomIndex]}`);
  }

  return appendEmoji(`NP: ${bestResp}`);
}

// ---------------- Typing Animation ----------------
function showTyping(callback){
  let i = 0;
  const phraseIndex = Math.floor(Math.random() * typingPhrases.length);
  const baseText = typingPhrases[phraseIndex];
  const dots = ["", " .", " ..", " ..."];
  
  const typingSound = document.getElementById('typingSound');
  typingSound.loop = true;
  typingSound.play();

  const typingBubble = addBubble(baseText + dots[i], 'bot-special');

  const interval = setInterval(()=>{
    i = (i + 1) % dots.length;
    typingBubble.innerHTML = baseText + dots[i] + 
      "<div class='timestamp'>" + new Date().toLocaleTimeString() + "</div>";
    bodyEl.scrollTo({ top: bodyEl.scrollHeight, behavior: 'smooth' });
  }, 300);

  setTimeout(()=>{
    clearInterval(interval);
    typingSound.pause();
    typingSound.currentTime = 0;
    bubbles.removeChild(typingBubble);
    callback();
  }, 1000 + Math.random() * 800);
}

// ---------------- UI ----------------
const bubbles = document.getElementById('bubbles');
const bodyEl = document.getElementById('body');
const sendBtn = document.getElementById('sendBtn');
const msgInput = document.getElementById('msg');

function addBubble(text, type){
  const b = document.createElement('div');
  b.className = 'bubble ' + type;
  b.innerHTML = text + '<div class="timestamp">'+new Date().toLocaleTimeString()+'</div>';
  bubbles.appendChild(b);
  bodyEl.scrollTo({ top: bodyEl.scrollHeight, behavior: 'smooth' });
  return b;
}

// Human-like typing effect
function typeResponse(text){
  const bubble = addBubble('', 'bot');
  const typingSound = document.getElementById('typingSound');
  typingSound.loop = false;
  typingSound.volume = 0.20;
  let i = 0;
  const cursor = '<span class="cursor">|</span>';

  function typeNextChar(){
    if(i <= text.length){
      const visibleText = text.slice(0,i);
      bubble.innerHTML = visibleText + cursor + '<div class="timestamp">'+new Date().toLocaleTimeString()+'</div>';
      bodyEl.scrollTo({ top: bodyEl.scrollHeight, behavior:'smooth'});
      if(i%3===0 && i<text.length){
        typingSound.currentTime=0;
        typingSound.play().catch(()=>{});
      }
      let delay=-1000+Math.random()*29;
      const char=text[i-1];
      if(char===','||char===';') delay=200+Math.random()*150;
      if(char==='.'||char==='!'||char==='?') delay=300+Math.random()*200;
      i++;
      setTimeout(typeNextChar, delay);
    } else {
      bubble.innerHTML=text+'<div class="timestamp">'+new Date().toLocaleTimeString()+'</div>';
      typingSound.pause();
      typingSound.currentTime=0;
    }
  }
  typeNextChar();
}

function sendMessage(){
  const text=msgInput.value.trim();
  if(!text) return;
  addBubble('<strong>you:</strong> '+text,'user');
  msgInput.value='';
  showTyping(()=>{ typeResponse(getResponse(text)); });
}

sendBtn.addEventListener('click',sendMessage);
msgInput.addEventListener('keydown',e=>{if(e.key==='Enter') sendMessage();});

document.getElementById('resetBtn').addEventListener('click',()=>{
  bubbles.innerHTML='';
  chatContext.mentionedProducts.clear();
  addBubble("NP: Welcome back! How can NYPADROX help you today?",'bot');
});

document.addEventListener('click',e=>{
  if(e.target.tagName==='A' && (e.target.href.includes('tel') || e.target.href.includes('mailto'))){
    navigator.clipboard.writeText(e.target.innerText);
    alert('Copied: '+e.target.innerText);
  }
});
</script>
</body>
</html>
